<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannon Blast</title>
    <link rel="icon" href="Immagini/bottoni/coez.png">
</head>
<script>
    //principali:
    //TODO: modificare immagini palle
    //TODO: commentare
    //TODO: aggiungere suoni per spari, palle distrutte, vittoria e sconfitta e bottoni cliccati (se troppo complicato fare il suono per il click
    //TODO: aggiungere salvataggio
    //TODO: inserirre counter kill(implementerlo con la barra di riempimento di fine livello)
    //FIXME: ottimizzare il controllo delle collisioni in modo da fare meno controlli(Spatial Partitioning)
    //BUG: fixare le scritte delle palle che si sovrappongono tra di loro (magari facendo un random che alla generazione delle scritte insierisce zindex alle palle e scritte di 1/2 o 3/4)

    //efficienza modifica programma:
    //TODO: se ci sono alcuni oggetti con classi e proprietà attribuite da javascript, mettere le proprietà su css
    //TODO: fare cose con le classi e id per rendere tutto più pulito
    //TODO: sistemare l'interfaccia e mettere le cose dove devono stare
    //TODO: sostituire i bottoni immagini con dei button per poterli premere con tab

    //estetica:
    //TODO: fare una animazione di scomparsa del menu per renderlo più carino

    //opzionali:
    //TODO: barra di riempimento di fine livello
    //TODO: se sei in una sezione non permettere di ricliccare sulla sezione
    //TODO: rendere il programma funzionante anche con schermo rimpicciolito

    "use strict";
    let padre;
    let barraSuperiore;
    let playerMusicaBackground;
    let musicaSbloccata = false;
    function onload() {
        padre = document.getElementsByTagName("body")[0]//.querySelector("div");
        padre.style.backgroundImage = "url('Immagini/sfondi/sfondo-natura.png')";
        barraSuperiore = document.getElementById("barra");
        document.addEventListener("keydown", tastoPremuto);
        document.addEventListener("keyup", tastoRilasciato);
        playerMusicaBackground = document.getElementById("musicaBackground");
        //document.addEventListener("click", function () { playerMusicaBackground.paused && playerMusicaBackground.currentTime == 0 ? playerMusicaBackground.play() : null; musicaSbloccata = true });
        for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
            document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/button.png')";
        }
        document.getElementById("barraSinistra").style.backgroundImage = "url('Immagini/icone/sound.png')";
    }

    let potenziaVelocita = {
        id: "potenziaVelocita",
        immagine: "Immagini/icone/scarpa-alata.png",
        valuta: "Immagini/icone/coin.png",
        costo: 20,
        livello: 1,
        livelloMax: 25
    };

    let potenziaDanno = {
        id: "potenziaDanno",
        immagine: "Immagini/icone/esplosione.png",
        valuta: "Immagini/icone/coin.png",
        costo: 20,
        livello: 1,
        livelloMax: 25
    };

    let potereDannoDoppio = {
        id: "potereDannoDoppio",
        immagine: "Immagini/icone/x2.png",
        valuta: "Immagini/icone/coin.png",
        costo: 150,
        livello: 1,
        comprato: false
    };

    let potereInvisibile = {
        id: "potereInvisibile",
        immagine: "Immagini/icone/fantasmino.png",
        valuta: "Immagini/icone/coin.png",
        costo: 150,
        comprato: false
    };

    let temaCandyland = {
        id: "temaCandyland",
        immagine: "Immagini/proiettili/proiettile-candyland.png",
        valuta: "Immagini/icone/diamante.png",
        costo: 300,
        comprato: false
    };

    let temaInferno = {
        id: "temaInferno",
        immagine: "Immagini/proiettili/proiettile-inferno.png",
        valuta: "Immagini/icone/diamante.png",
        costo: 500,
        comprato: false
    };

    let temaGalaxy = {
        id: "temaGalaxy",
        immagine: "Immagini/proiettili/proiettile-galaxy.png",
        valuta: "Immagini/icone/diamante.png",
        costo: 1000,
        comprato: false
    };

    let temaOG = {
        id: "temaOG",
        immagine: "Immagini/proiettili/proiettile.png",
        valuta: "Immagini/icone/diamante.png",
        costo: 2000,
        comprato: false
    };

    // Creo la lista includendo tutti gli oggetti
    let listaArticoliNegozio = [
        // sezionePotenziamenti,
        // sezionePoteri,
        // sezioneTemi,
        potenziaVelocita,
        potenziaDanno,
        potereDannoDoppio,
        potereInvisibile,
        temaInferno,
        temaCandyland,
        temaGalaxy,
        temaOG
    ];

    let dimensioniCannoneWidth = 200;
    let dimensioniCannoneHeight = 200;
    let dimensioniPalleWidth = 200;
    let dimensioniPalleHeight = 200;
    let dimensioniProiettiliWidth = 200;
    let dimensioniProiettiliHeight = 200;
    let listaPalle = [];
    let listaProiettili = [];
    let listaGrafichePalle = ["Immagini/palle/palla-natura1.png", "Immagini/palle/palla-natura2.png", "Immagini/palle/palla-natura3.png", "Immagini/palle/palla-natura4.png"];
    let timerCreaPalle;
    let timerMuoviPP;
    let timerSvuotaProiettili;
    let timerGemme;
    let passo = 25; //minimo:25 | massimo: 150
    let passoMax = passo;
    let cannone = { immagine: "Immagini/cannoni/cannone-natura.png" };
    let danno = 5; //minimo: 5 | massimo: 30
    let controllaCollisioni = false;
    let fuoriPartita = true; //true all'inizio in modo da evitare che keydown si attivi prima che il cannone sia stato creato
    let schermataGioco;
    let monete = 100000;
    let moneteDurantePartita = 0;
    let gemme = 100000;
    let gemmeDurantePartita = 0;
    let timerCannoneSinistra;
    let timerCannoneDestra;
    let timerCannoneSpara;
    let vitaPalle = 500; //cambia
    let massimoPalle = 5; //cambia
    let timerAumentoDifficolta;
    let timerDurataPartita;
    let countdown;
    let modalita;
    let recordEndless = 0;
    let recordLivello1 = 0;
    let recordLivello2 = 0;
    let recordLivello3 = 0;
    let recordLivello4 = 0;
    let punteggioAttuale = 0;
    let kill = 0;
    let obbiettivoKill;
    let sezioneArticoli;

    let temaNaturaAttivo = true;
    let temaInfernoAttivo = false;
    let temaCandylandAttivo = false;
    let temaGalaxyAttivo = false;
    let temaOGAttivo = false;

    let potereDannoDoppioSbloccato = false;
    let potereInvisibileSbloccato = false;

    let potere;
    let potereAttivo = false;
    let timerPotere;
    let colpibile = true;
    let controllaCollisioniPotere = false;

    let immagineProiettile = "Immagini/proiettili/proiettile-natura.png";

    // let potereDannoDoppioSbloccato = false;
    // let potereInvisibileSbloccato = false;
    // let temaCandylandSbloccato = false;
    // let temaGalaxySbloccato = false;
    // let temaInfernoSbloccato = false;
    // let temaOGSbloccato = false;
    // let listaBarra = [];
    // listaBarra.length=8;
    // console.log(listaBarra);
    function cambioSezione() {
        while (padre.querySelector("*:not(.menu):not(.barra):not(#musicaBackground)")) {
            console.log(padre.querySelector("*:not(.menu):not(.barra):not(#musicaBackground)"));
            padre.removeChild(padre.querySelector("*:not(.menu):not(.barra):not(#musicaBackground)"));
        }
    }
    //sezione endless non presente perchè integrata in livello selezionato
    function sezioneLivelli() {
        cambioSezione();
        let centraLivelli = document.createElement("div");
        let livello1 = document.createElement("div");
        let livello2 = document.createElement("div");
        let livello3 = document.createElement("div");
        let livello4 = document.createElement("div");
        centraLivelli.id = "centraLivelli";
        livello1.className = "livello";
        livello2.className = "livello";
        livello3.className = "livello";
        livello4.className = "livello";
        livello1.id = "livello1";
        livello2.id = "livello2";
        livello3.id = "livello3";
        livello4.id = "livello4";
        livello1.addEventListener("click", livelloSelezionato);
        livello2.addEventListener("click", livelloSelezionato);
        livello3.addEventListener("click", livelloSelezionato);
        livello4.addEventListener("click", livelloSelezionato);
        padre.appendChild(centraLivelli);
        centraLivelli.appendChild(livello1);
        centraLivelli.appendChild(livello2);
        centraLivelli.appendChild(livello3);
        centraLivelli.appendChild(livello4);
        livello1.innerText = "1";
        livello2.innerText = "2";
        livello3.innerText = "3";
        livello4.innerText = "4";
        //seleziona i livelli e quando seleziona uno dei livelli compare schermata gioco
        // creaSchermata();
        // schermataGioco.innerHTML = "<h2>Endless Mode</h2> <span><p>Record: 531408 palle distrutte/tempo sopravvissuto <button>Gioca</button>";
        //     schermataGioco.querySelector("button").addEventListener("click", startPartita); //mhh me puzza
    }
    function sezioneNegozio() {
        cambioSezione();
        sezioneArticoli = document.createElement("div");
        let sezionePotenziamenti = document.createElement("div");
        let sezionePoteri = document.createElement("div");
        let sezioneTemi = document.createElement("div");
        sezioneArticoli.id = "sezioneArticoli";
        sezioneArticoli.classList.add("barraPresente");
        sezionePotenziamenti.id = "sezionePotenziamenti";
        sezionePoteri.id = "sezionePoteri";
        sezioneTemi.id = "sezioneTemi";
        padre.appendChild(sezioneArticoli);
        sezioneArticoli.appendChild(sezionePotenziamenti);
        sezioneArticoli.appendChild(sezionePoteri);
        sezioneArticoli.appendChild(sezioneTemi);
        sezioneArticoli.classList.add("negozio");
        sezionePotenziamenti.className = "negozio";
        sezionePoteri.className = "negozio";
        sezioneTemi.className = "negozio";




        listaArticoliNegozio.forEach(articolo => {
            articolo.corpo = document.createElement("div");
            // temaNaturaAttivo=false;
            // temaGalaxyAttivo = true;
            if (temaNaturaAttivo) {
                articolo.corpo.style.backgroundImage = "url('Immagini/bottoni/button.png')";
            } else {
                if (temaCandylandAttivo) {
                    articolo.corpo.style.backgroundImage = "url('Immagini/bottoni/button-candyland.png')";
                } else {
                    if (temaGalaxyAttivo) {
                        articolo.corpo.style.backgroundImage = "url('Immagini/bottoni/button-galaxy.png')";
                    } else {
                        if (temaInfernoAttivo) {
                            articolo.corpo.style.backgroundImage = "url('Immagini/bottoni/button-inferno.png')";
                        } else {
                            if (temaOGAttivo) {
                                articolo.corpo.style.backgroundImage = "url('Immagini/bottoni/coez.png')";
                            }
                        }
                    }
                }
            }
            articolo.corpo.className = "negozio prezzo";
            articolo.corpo.id = articolo.id;
            articolo.corpo.addEventListener("click", funzioneNegozio(articolo));
            // articolo.corpo.src = "Coez.PNG"; tenere in caso si faccia uno sfondo diverso in base alla sezione
            if (articolo.id.startsWith("potenzia")) {
                aggiornaScrittaNegozio(articolo)
                sezionePotenziamenti.appendChild(articolo.corpo);
            } else {
                if (articolo.id.startsWith("potere")) {
                    aggiornaScrittaNegozio(articolo)
                    sezionePoteri.appendChild(articolo.corpo);
                } else {
                    aggiornaScrittaNegozio(articolo)
                    sezioneTemi.appendChild(articolo.corpo);
                }
            }
        });
    }
    function sezioneGuardaroba() {
        cambioSezione();
        let centraTemi = document.createElement("div");
        centraTemi.id = "centraTemi";
        padre.appendChild(centraTemi);
        let natura = document.createElement("img");
        natura.addEventListener("click", cambioTema);
        natura.className = "guardaroba";
        natura.id = "natura";
        natura.src = "Immagini/proiettili/proiettile-natura.png";
        centraTemi.appendChild(natura);
        let posizione1 = listaArticoliNegozio.findIndex(articolo => articolo.id === "temaCandyland");
        let posizione2 = listaArticoliNegozio.findIndex(articolo => articolo.id === "temaGalaxy");
        let posizione3 = listaArticoliNegozio.findIndex(articolo => articolo.id === "temaInferno");
        let posizione4 = listaArticoliNegozio.findIndex(articolo => articolo.id === "temaOG");
        if (listaArticoliNegozio[posizione1].comprato == true) {
            let candyland = document.createElement("img");
            candyland.addEventListener("click", cambioTema);
            candyland.className = "guardaroba";
            candyland.id = "candyland";
            candyland.src = "Immagini/proiettili/proiettile-candyland.png";
            centraTemi.appendChild(candyland);
        }
        if (listaArticoliNegozio[posizione2].comprato == true) {
            let galaxy = document.createElement("img");
            galaxy.addEventListener("click", cambioTema);
            galaxy.className = "guardaroba";
            galaxy.id = "galaxy";
            galaxy.src = "Immagini/proiettili/proiettile-galaxy.png";
            centraTemi.appendChild(galaxy);
        }
        if (listaArticoliNegozio[posizione3].comprato == true) {
            let inferno = document.createElement("img");
            inferno.addEventListener("click", cambioTema);
            inferno.className = "guardaroba";
            inferno.id = "inferno";
            inferno.src = "Immagini/proiettili/proiettile-inferno.png";
            centraTemi.appendChild(inferno);
        }
        if (listaArticoliNegozio[posizione4].comprato == true) {
            let og = document.createElement("img");
            og.addEventListener("click", cambioTema);
            og.className = "guardaroba";
            og.id = "og";
            og.src = "Immagini/proiettili/proiettile.png";
            centraTemi.appendChild(og);
        }

        // temaInferno,
        // temaCandyland,
        // temaGalaxy,
        // temaOG
    }
    function sezioneImpostazioni() {
        cambioSezione();
        let sliderAudioNome = document.createElement("label");
        let sliderAudio = document.createElement("input");
        sliderAudio.type = "range";
        sliderAudio.min = 0;
        sliderAudio.max = 100;
        sliderAudio.value = 100;
        sliderAudio.className = "sliderAudio";
        sliderAudio.step = 10;
        sliderAudio.addEventListener("input", function () {
            playerMusicaBackground.volume = this.value / 100;
        });
        sliderAudioNome.innerText = "volume Audio";
        sliderAudioNome.className = "sliderAudio";

        let sliderPassoNome = document.createElement("label");
        let sliderPasso = document.createElement("input");
        sliderPasso.type = "range";
        sliderPasso.min = 25;
        sliderPasso.max = passoMax;
        sliderPasso.value = passo;
        sliderPasso.className = "sliderPasso";
        sliderPasso.step = 5;
        sliderPasso.addEventListener("input", function () {
            console.log(this.value);
            passo = parseInt(this.value);//cambiando il valore di passo con lo slider nelle impostazione il valore diventa una stringa, provocando
            // playerMusicaBackground.volume = this.value / 100;
        });
        sliderPassoNome.innerText = "Velocità cannone";
        sliderPassoNome.className = "sliderPasso";
        padre.appendChild(sliderAudioNome);
        padre.appendChild(sliderAudio);
        padre.appendChild(sliderPassoNome);
        padre.appendChild(sliderPasso);
        // <input type="range" id="volumeSlider" min="0" max="1" value="50">

    }
    function cambioTema(event) {
        console.log("inizio prova:");
        console.log(event.target);
        console.log(document.getElementsByClassName("guardaroba")[0]);
        if (event.target.id == "natura") {
            console.log("tema: natura");
            temaNaturaAttivo = true;
            temaCandylandAttivo = false;
            temaGalaxyAttivo = false;
            temaInfernoAttivo = false;
            temaOGAttivo = false;
            cannone.immagine = "Immagini/cannoni/cannone-natura.png";
            immagineProiettile = "Immagini/proiettili/proiettile-natura.png";
            for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
                document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/button.png')";
            }
            padre.style.backgroundImage = "url('Immagini/sfondi/sfondo-natura.png')";
            listaGrafichePalle = ["Immagini/palle/palla-natura1.png", "Immagini/palle/palla-natura2.png", "Immagini/palle/palla-natura3.png", "Immagini/palle/palla-natura4.png"];
        } else {
            if (event.target.id == "candyland") {
                console.log("tema: candyland");
                temaNaturaAttivo = false;
                temaCandylandAttivo = true;
                temaGalaxyAttivo = false;
                temaInfernoAttivo = false;
                temaOGAttivo = false;
                cannone.immagine = "Immagini/cannoni/cannone-candyland.png";
                immagineProiettile = "Immagini/proiettili/proiettile-candyland.png";
                for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
                    document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/button-candyland.png')";
                }
                padre.style.backgroundImage = "url('Immagini/sfondi/sfondo-candyland.png')";
                listaGrafichePalle = ["Immagini/palle/palla-candyland1.png", "Immagini/palle/palla-candyland2.png", "Immagini/palle/palla-candyland3.png", "Immagini/palle/palla-candyland4.png"];
            } else {
                if (event.target.id == "galaxy") {
                    console.log("tema: galaxy");
                    temaNaturaAttivo = false;
                    temaCandylandAttivo = false;
                    temaGalaxyAttivo = true;
                    temaInfernoAttivo = false;
                    temaOGAttivo = false;
                    cannone.immagine = "Immagini/cannoni/cannone-galaxy.png";
                    immagineProiettile = "Immagini/proiettili/proiettile-galaxy.png";
                    for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
                        document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/button-galaxy.png')";
                    }
                    padre.style.backgroundImage = "url('Immagini/sfondi/sfondo-galaxy.png')";
                    listaGrafichePalle = ["Immagini/palle/palla-galaxy1.png", "Immagini/palle/palla-galaxy2.png", "Immagini/palle/palla-galaxy3.png", "Immagini/palle/palla-galaxy4.png"];
                } else {
                    if (event.target.id == "inferno") {
                        console.log("tema: inferno");
                        temaNaturaAttivo = false;
                        temaCandylandAttivo = false;
                        temaGalaxyAttivo = false;
                        temaInfernoAttivo = true;
                        temaOGAttivo = false;
                        cannone.immagine = "Immagini/cannoni/cannone-inferno.png";
                        immagineProiettile = "Immagini/proiettili/proiettile-inferno.png";
                        for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
                            document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/button-inferno.png')";
                        }
                        padre.style.backgroundImage = "url('Immagini/sfondi/sfondo-inferno.png')";
                        listaGrafichePalle = ["Immagini/palle/palla-inferno1.png", "Immagini/palle/palla-inferno2.png", "Immagini/palle/palla-inferno3.png", "Immagini/palle/palla-inferno4.png"];
                    } else {
                        if (event.target.id == "og") {
                            console.log("tema: og");
                            temaNaturaAttivo = false;
                            temaCandylandAttivo = false;
                            temaGalaxyAttivo = false;
                            temaInfernoAttivo = false;
                            temaOGAttivo = true;
                            cannone.immagine = "Immagini/cannoni/cannone.png";
                            immagineProiettile = "Immagini/proiettili/proiettile.png";
                            for (let i = 0; i < document.querySelector("nav").querySelectorAll("div").length; i++) {
                                document.querySelector("nav").querySelectorAll("div")[i].style.backgroundImage = "url('Immagini/bottoni/coez.png')";
                            }
                            padre.style.backgroundImage = "";
                            listaGrafichePalle = ["Immagini/palle/palla1.png", "Immagini/palle/palla2.png", "Immagini/palle/palla3.png", "Immagini/palle/palla4.png"];
                        }
                    }
                }
            }
        }
    }
    function aggiornaScrittaNegozio(articolo) {
        if (articolo.id == "potenziaDanno" || articolo.id == "potenziaVelocita") {
            //non funziona
            //sistemare le immagini sulla barra superiore
            // console.log("inizio test interessato");
            // console.log(articolo.livello);
            // console.log(articolo.livelloMax);
            // console.log(articolo.livello<articolo.livelloMax);
            if (articolo.livello < articolo.livelloMax) {
                articolo.corpo.innerHTML = "<img src=" + articolo.immagine + "><label>costo: " + articolo.costo + "<img src=" + articolo.valuta + "> livello: " + articolo.livello + "</label>";
            } else {
                articolo.corpo.innerHTML = "<img src=" + articolo.immagine + "><label>Livello Massimo</label>";
            }
        } else {
            if (articolo.comprato) {
                articolo.corpo.innerHTML = "<img src=" + articolo.immagine + "><label>Sold out</label>";
            } else {
                articolo.corpo.innerHTML = "<img src=" + articolo.immagine + "><label>costo: " + articolo.costo + "<img src=" + articolo.valuta + "></label>";
            }
        }
    }
    function funzioneNegozio(articolo) {//siccome non posso mettere un parametro nell'event listener uso questa funzione di passaggio
        return function () {
            negozio(articolo);
        };
    }
    function negozio(articolo) {

        if (articolo.id == "potenziaVelocita" || articolo.id == "potenziaDanno") {
            if (monete > articolo.costo) {
                if (articolo.livello <= articolo.livelloMax) {
                    if (articolo.id == "potenziaVelocita") {
                        passoMax += 5;
                    } else {
                        danno += 1;
                    }
                    console.log("danno: " + danno);
                    console.log("passo:" + passo);
                    articolo.livello++;
                    articolo.costo += 20;
                    monete -= articolo.costo;

                }
            } else {
                alert("monete insufficienti");//cambiare la scritta per 1 secondo per poi tornare normale
            }
        } else {
            if (articolo.id == "potereDannoDoppio" || articolo.id == "potereInvisibile") {
                if (monete > articolo.costo) {
                    if (!articolo.comprato) {
                        articolo.comprato = true;
                        if (articolo.id == "potereDannoDoppio") {
                            potereDannoDoppioSbloccato = true;
                        }
                        if (articolo.id == "potereInvisibile") {
                            potereInvisibileSbloccato = true;
                        }
                        monete -= articolo.costo;
                    }
                } else {
                    alert("monete insufficienti");
                }
            } else {
                if (gemme > articolo.costo) {
                    if (!articolo.comprato) {
                        articolo.comprato = true;
                        gemme -= articolo.costo;
                    }
                } else {
                    alert("gemme insufficienti");
                }
            }
        }
        aggiornaScrittaNegozio(articolo);
        document.getElementById("coin").innerText = monete;
        document.getElementById("diamante").innerText = gemme;
    }
    function creaSchermata() {
        schermataGioco = document.createElement("div");
        schermataGioco.id = "schermataGioco";
        if (temaNaturaAttivo) {
            schermataGioco.style.backgroundImage = "url('Immagini/bottoni/button.png')";
        } else {
            if (temaCandylandAttivo) {
                schermataGioco.style.backgroundImage = "url('Immagini/bottoni/button-candyland.png')";
            } else {
                if (temaGalaxyAttivo) {
                    schermataGioco.style.backgroundImage = "url('Immagini/bottoni/button-galaxy.png')";
                } else {
                    if (temaInfernoAttivo) {
                        schermataGioco.style.backgroundImage = "url('Immagini/bottoni/button-inferno.png')";
                    } else {
                        if (temaOGAttivo) {
                            schermataGioco.style.backgroundImage = "url('Immagini/bottoni/coez.png')";
                        }
                    }
                }
            }
        }
        padre.appendChild(schermataGioco);
    }
    function livelloSelezionato(event) {
        console.log("GAY");
        console.log(event.target);
        console.log(event.target.innerText == "riprova");
        console.log(event.target.classList.contains("endless") || (modalita == "endless" && event.target.innerText == "riprova"));
        if (event.target.classList.contains("endless") || (modalita == "endless" && event.target.innerText == "riprova")) {
            massimoPalle = 3;
            vitaPalle = 200;
            countdown = 0;
            if (event.target.classList.contains("endless")) {
                modalita = "";
            }
            if (modalita != "endless") {
                cambioSezione();//forse meglio non metterlo
                creaSchermata();
                schermataGioco.innerHTML = "<h2>Endless Mode</h2> <p>Record:" + recordEndless + "</p><button>Gioca</button>";
                schermataGioco.querySelector("button").addEventListener("click", startPartita)//mhh me puzza
            } else {
                startPartita();
                document.getElementById("barraCentro").innerText = countdown;
            }
            modalita = "endless";
            console.log("difficoltà endless");
        } else {
            if (document.getElementById("livello1") == event.target || (modalita == "livello1" && event.target.innerText == "riprova")) {
                massimoPalle = 3;
                vitaPalle = 200;
                countdown = 100;
                obbiettivoKill = 10;
                if (document.getElementById("livello1") == event.target) {
                    modalita = "";
                }
                if (modalita != "livello1") {
                    cambioSezione();//forse meglio non metterlo
                    creaSchermata();
                    schermataGioco.innerHTML = "<h2>Livello 1</h2> <p>Record:" + recordLivello1 + "</p><button>Gioca</button><button>Indietro</button>";
                    schermataGioco.querySelectorAll("button")[0].addEventListener("click", startPartita);
                    schermataGioco.querySelectorAll("button")[1].addEventListener("click", sezioneLivelli);//mhh me puzza
                } else {
                    startPartita();
                    document.getElementById("barraCentro").innerText = countdown;
                }
                modalita = "livello1";
                console.log("difficoltà 1");
            } else {
                if (document.getElementById("livello2") == event.target || (modalita == "livello2" && event.target.innerText == "riprova")) {
                    massimoPalle = 5;
                    vitaPalle = 500;
                    countdown = 80;
                    obbiettivoKill = 10;
                    if (document.getElementById("livello2") == event.target) {
                        modalita = "";
                    }
                    if (modalita != "livello2") {
                        cambioSezione();//forse meglio non metterlo
                        creaSchermata();
                        schermataGioco.innerHTML = "<h2>Livello 2</h2> <p>Record:" + recordLivello2 + "</p><button>Gioca</button><button>Indietro</button>";
                        schermataGioco.querySelectorAll("button")[0].addEventListener("click", startPartita);
                        schermataGioco.querySelectorAll("button")[1].addEventListener("click", sezioneLivelli);//mhh me puzza
                    } else {
                        startPartita();
                        document.getElementById("barraCentro").innerText = countdown;
                    }
                    modalita = "livello2";
                    console.log("difficoltà 2");
                } else {
                    if (document.getElementById("livello3") == event.target || (modalita == "livello3" && event.target.innerText == "riprova")) {
                        massimoPalle = 7;
                        vitaPalle = 1000;
                        countdown = 70;
                        obbiettivoKill = 15;
                        if (document.getElementById("livello3") == event.target) {
                            modalita = "";
                        }
                        if (modalita != "livello3") {
                            cambioSezione();//forse meglio non metterlo
                            creaSchermata();
                            schermataGioco.innerHTML = "<h2>Livello 3</h2> <p>Record:" + recordLivello3 + "</p><button>Gioca</button><button>Indietro</button>";
                            schermataGioco.querySelectorAll("button")[0].addEventListener("click", startPartita);
                            schermataGioco.querySelectorAll("button")[1].addEventListener("click", sezioneLivelli);//mhh me puzza
                        } else {
                            startPartita();
                            document.getElementById("barraCentro").innerText = countdown;
                        }
                        modalita = "livello3";
                        console.log("difficoltà 3");
                    } else {
                        if (document.getElementById("livello4") == event.target || (modalita == "livello4" && event.target.innerText == "riprova")) {
                            massimoPalle = 10;
                            vitaPalle = 2000;
                            countdown = 100;
                            obbiettivoKill = 20;
                            if (document.getElementById("livello4") == event.target) {
                                modalita = "";
                            }
                            if (modalita != "livello4") {
                                cambioSezione();//forse meglio non metterlo
                                creaSchermata();
                                schermataGioco.innerHTML = "<h2>Livello 4</h2> <p>Record:" + recordLivello4 + "</p><button>Gioca</button><button>Indietro</button>";
                                schermataGioco.querySelectorAll("button")[0].addEventListener("click", startPartita);
                                schermataGioco.querySelectorAll("button")[1].addEventListener("click", sezioneLivelli);//mhh me puzza
                            } else {
                                startPartita();
                                document.getElementById("barraCentro").innerText = countdown;
                            }
                            modalita = "livello4";
                            console.log("difficoltà 4");
                        }
                    }
                }
            }
        }
    }
    function startPartita(event) {
        cambioSezione();
        fuoriPartita = false;
        potere = undefined;
        console.log(padre.querySelector("nav"));
        padre.querySelector("nav").style.display = "none";
        document.getElementById("barraCentro").innerText = countdown;
        if (modalita == "endless") {
            timerAumentoDifficolta = window.setInterval(aumentaDifficolta, 20000);//serve solo nella modalità endless
            timerDurataPartita = window.setInterval(function () {//serve solo nella modalità a livelli
                countdown++;
                document.getElementById("barraCentro").innerText = countdown;
            }, 1000);
        } else {
            timerDurataPartita = window.setInterval(function () {//serve solo nella modalità a livelli
                countdown--;
                document.getElementById("barraCentro").innerText = countdown;
                if (countdown == 0) {
                    fuoriPartita = true;
                    sconfitta();
                }
            }, 1000);
        }
        timerGemme = window.setInterval(function () { gemmeDurantePartita++ }, 10000);
        timerCreaPalle = window.setInterval(creaPalle, 3000);
        timerMuoviPP = window.setInterval(muoviPP, 1);
        //scrivere personalizzazione
        creaCannone();
        padre.appendChild(cannone.corpo);
    }
    function aumentaDifficolta() {
        massimoPalle += 1;
        vitaPalle += 200;
    }
    function creaCannone() {
        let corpoCannone = document.createElement("img"); //crea il cannone
        let immagineTemporanea = cannone.immagine;
        cannone = { x: window.innerWidth / 2 - dimensioniCannoneWidth / 2, y: window.innerHeight - dimensioniCannoneHeight, corpo: corpoCannone, immagine: immagineTemporanea };
        cannone.corpo.style.left = cannone.x + "px";
        cannone.corpo.style.top = cannone.y + "px";
        corpoCannone.src = cannone.immagine;
        corpoCannone.style.width = dimensioniCannoneWidth + "px";
        corpoCannone.style.height = dimensioniCannoneHeight + "px";
    }
    function muoviPP() {
        //muovi Palle
        for (let i = 0; i < listaPalle.length; i++) {
            //muove la x(destra e sinistra) delle palle
            if (listaPalle[i].destra) {
                listaPalle[i].x += listaPalle[i].curvaturaX;
            } else {
                listaPalle[i].x -= listaPalle[i].curvaturaX;
            }
            if (listaPalle[i].cambioCurvatura) {
                listaPalle[i].curvaturaX = Math.random() * 4 + 1;
                // listaPalle[i].curvaturaY = Math.random() * 4 + 1;
                listaPalle[i].cambioCurvatura = false;
            }
            if (listaPalle[i].x + dimensioniPalleWidth >= window.innerWidth || listaPalle[i].x <= 0) {
                listaPalle[i].destra = !listaPalle[i].destra;
                listaPalle[i].cambioCurvatura = true;
            }
            //muove la y(su e giu) delle palle
            if (listaPalle[i].su) {
                listaPalle[i].y -= listaPalle[i].curvaturaY;
            } else {
                listaPalle[i].y += listaPalle[i].curvaturaY;
            }
            if (listaPalle[i].cambioCurvatura) {
                // listaPalle[i].curvaturaX = Math.random() * 4 + 1;
                listaPalle[i].curvaturaY = Math.random() * 4 + 1;
                listaPalle[i].cambioCurvatura = false;
            }
            if (listaPalle[i].y + dimensioniPalleHeight >= window.innerHeight || listaPalle[i].y <= 0) {
                listaPalle[i].su = !listaPalle[i].su;
                listaPalle[i].cambioCurvatura = true;
            }
            // aggiunge i valori modificati negli oggetti alle proprietà css delle immagini
            listaPalle[i].corpo.style.left = listaPalle[i].x + "px";
            listaPalle[i].scritta.style.left = listaPalle[i].x + "px";
            listaPalle[i].corpo.style.top = listaPalle[i].y + "px";
            listaPalle[i].scritta.style.top = listaPalle[i].y + "px";
            // console.log(listaPalle[i].destra);
            // console.log(listaPalle[i].x);
            // console.log(listaPalle[i].su);
            // console.log(listaPalle[i].y);
        }
        collisioniPallaCannone();
        if (controllaCollisioni) {
            collisioniProiettilePalla();
        }
        //Muovi Proiettili
        for (let i = 0; i < listaProiettili.length; i++) {
            listaProiettili[i].y -= 50;
            listaProiettili[i].corpo.style.top = listaProiettili[i].y + "px";
            if (listaProiettili[i].y < -dimensioniProiettiliHeight) {
                padre.removeChild(listaProiettili[i].corpo);
                listaProiettili.splice(i, 1);
                i--;
            }
        }
        //Muovi potere
        if (potere) {
            potere.y++;
            potere.corpo.style.top = potere.y + "px";
            if (potere.y >= window.innerHeight) {
                padre.removeChild(potere.corpo);
                potere = undefined;
                controllaCollisioniPotere = false;
            }
        }
        if (controllaCollisioniPotere && potere) {
            collisioniPotereCannone();
        }
    }
    function creaPalle() {
        if (listaPalle.length < massimoPalle) {
            let palla = {
                destra: Math.random() > 0.5 ? true : false,
                curvaturaX: Math.random() * 4 + 1,
                curvaturaY: Math.random() * 4 + 1,
                cambioCurvatura: false,
                su: false, //se la palla deve cadere oppure se rimbalza in su 
                y: 0, //all'inizio è uguale a yMax
                yMax: 0, //fissa oppure che cambia ogni volta ma non cambia in game, massima altezza rimbalzo
                immagine: listaGrafichePalle[Math.floor(Math.random() * 4)],
                vita: vitaPalle,
                corpo: document.createElement("img"),
                scritta: document.createElement("p")
            }
            palla.corpo.style.width = dimensioniPalleWidth + "px";
            palla.corpo.style.height = dimensioniPalleHeight + "px";
            //elementi che dipendono da altri vanno creati dopo
            palla.x = palla.destra ? 0 : window.innerWidth - dimensioniPalleWidth, //o tutto sinistra o tutto destra, dipende dalla proprietà destra all'inizio
                palla.corpo.style.left = palla.x + "px";
            palla.scritta.style.left = palla.x + "px";
            // console.log(Math.random()>0.5 ? true : false);
            palla.corpo.src = palla.immagine;
            palla.scritta.style.zIndex = 2;
            palla.scritta.style.height = dimensioniPalleHeight / 2 + "px";
            palla.scritta.style.width = dimensioniPalleWidth + "px";
            palla.scritta.style.paddingTop = dimensioniPalleHeight / 4 + "px";
            palla.scritta.className = "vita";
            listaPalle.push(palla);
            padre.appendChild(palla.corpo);
            palla.scritta.innerText = palla.vita;
            padre.appendChild(palla.scritta);
            // window.clearInterval(timerCreaPalle);
            // window.clearInterval(timerMuoviPalle);
        }
    }
    function creaProiettile() {
        if (!fuoriPartita) {
            let proiettile = { y: cannone.y - dimensioniProiettiliHeight, x: cannone.x, corpo: document.createElement("img"), immagine: immagineProiettile };
            proiettile.corpo.src = proiettile.immagine;
            proiettile.corpo.style.width = dimensioniProiettiliWidth + "px";
            proiettile.corpo.style.height = dimensioniProiettiliHeight + "px";
            listaProiettili.push(proiettile);
            proiettile.corpo.style.top = proiettile.y + "px";
            proiettile.corpo.style.left = proiettile.x + "px";
            padre.appendChild(proiettile.corpo);
        }
    }
    function tastoPremuto(event) {
        console.log(event.key);
        if (event.key === "Control" && musicaSbloccata) {
            if (playerMusicaBackground.paused) {
                playerMusicaBackground.play();
                document.getElementById("barraSinistra").style.backgroundImage = "url('Immagini/icone/sound.png')";
            } else {
                playerMusicaBackground.pause();
                console.log("GAYYYY");
                document.getElementById("barraSinistra").style.backgroundImage = "url('Immagini/icone/mute.png')";
            }
        }
        if (!fuoriPartita) {
            if (event.key === "ArrowLeft" || event.key === "A" || event.key === "a") {
                console.log(timerCannoneSinistra);
                if (!timerCannoneSinistra) {
                    if (timerCannoneDestra) {
                        window.clearInterval(timerCannoneDestra);
                        timerCannoneDestra = undefined;
                    }
                    timerCannoneSinistra = window.setInterval(function () {
                        if (cannone.x - passo >= 0) {
                            cannone.x -= passo;
                            cannone.corpo.style.left = cannone.x + "px";
                        }
                    }, 50);
                }
                console.log(event.key);
            }
            if (event.key === "ArrowRight" || event.key === "D" || event.key === "d") {
                if (!timerCannoneDestra) {
                    if (timerCannoneSinistra) {
                        window.clearInterval(timerCannoneSinistra);
                        timerCannoneSinistra = undefined;
                    }
                    timerCannoneDestra = window.setInterval(function () {
                        if (cannone.x + passo <= window.innerWidth - dimensioniCannoneWidth) {
                            cannone.x += parseInt(passo);
                            cannone.corpo.style.left = cannone.x + "px";
                        }
                    }, 50);
                }
                console.log(event.key);
            }
            if (event.key === "ArrowUp" || event.key === "W" || event.key === "w") {
                if (!timerCannoneSpara) {
                    timerCannoneSpara = window.setInterval(function () {
                        creaProiettile();
                        controllaCollisioni = true;
                    }, 50);
                }
                console.log(event.key);
            }
        }
        if (event.key === " ") {
            if (getComputedStyle(barraSuperiore).display == "flex") {//guarda qual'è il display effettivo indipendentemente da dove è stato assegnato
                barraSuperiore.style.display = "none";
                if (sezioneArticoli != undefined) {
                    sezioneArticoli.classList.remove("barraPresente");
                }
            }
            else {
                barraSuperiore.style.display = "flex";
                if (sezioneArticoli != undefined) {
                    sezioneArticoli.classList.add("barraPresente");
                }
            }
        }
    }
    function tastoRilasciato(event) {
        if (event.key === "ArrowLeft" || event.key === "A" || event.key === "a") {
            window.clearInterval(timerCannoneSinistra);
            timerCannoneSinistra = undefined;
            console.log(event.key);
        }
        if (event.key === "ArrowRight" || event.key === "D" || event.key === "d") {
            window.clearInterval(timerCannoneDestra);
            timerCannoneDestra = undefined;
            console.log(event.key);
        }
        if (event.key === "ArrowUp" || event.key === "W" || event.key === "w") {
            timerSvuotaProiettili = window.setInterval(svuotaProiettili, 50);
            window.clearInterval(timerCannoneSpara);
            timerCannoneSpara = undefined;
        }
    }
    function svuotaProiettili() {
        if (listaProiettili.length == 0) {
            window.clearInterval(timerSvuotaProiettili);
            controllaCollisioni = false;
        }
    }
    //cambiare dimensioni immagini con variabili
    function collisioniPallaCannone() {
        if (colpibile) {
            for (let i = 0; i < listaPalle.length; i++) {
                if (listaPalle[i].y + dimensioniPalleHeight >= cannone.y) {//42 è l'altezza a cui corrisponde l'inizio del cannone sull'immagine attuale
                    if ((listaPalle[i].x >= cannone.x && listaPalle[i].x <= cannone.x + dimensioniCannoneWidth) || (listaPalle[i].x + dimensioniPalleWidth >= cannone.x && listaPalle[i].x + dimensioniPalleWidth <= cannone.x + dimensioniCannoneWidth)) {
                        //hittato 
                        fuoriPartita = true;
                        sconfitta();
                    }
                }
            }
        }
    }
    function collisioniPotereCannone() {
        if (potere.y + dimensioniPalleHeight >= cannone.y) {//42 è l'altezza a cui corrisponde l'inizio del cannone sull'immagine attuale
            if ((potere.x >= cannone.x && potere.x <= cannone.x + dimensioniCannoneWidth) || (potere.x + dimensioniPalleWidth >= cannone.x && potere.x + dimensioniPalleWidth <= cannone.x + dimensioniCannoneWidth)) {
                console.log("entrato nella condizione");
                console.log("id: " + potere.id);
                potereAttivo = true;
                console.log("danno");
                console.log(danno);
                if (potere.id == "dannoDoppio") {
                    danno = danno * 2;
                    timerPotere = window.setTimeout(function () { danno = danno / 2; potereAttivo = false; console.log("danno Doppio finito") }, 10000);
                }
                console.log(danno);

                console.log("colpibile");
                console.log(colpibile);
                if (potere.id == "invisibile") {
                    cannone.corpo.style.opacity = "0.3";
                    colpibile = false;
                    timerPotere = window.setTimeout(function () { colpibile = true; potereAttivo = false; cannone.corpo.style.opacity = "1"; console.log("invisibilità finita") }, 10000);
                }
                console.log(colpibile);
                console.log("TESTTTTTTTTT");
                console.log(potere.corpo);
                padre.contains(potere.corpo)
                // if (padre.contains(potere.corpo)) {
                padre.removeChild(potere.corpo);
                controllaCollisioniPotere = false;
                // }
                potere = undefined;
            }
        }
    }
    function finePartita() {
        window.clearInterval(timerCreaPalle);
        window.clearInterval(timerMuoviPP);
        window.clearInterval(timerSvuotaProiettili);
        window.clearInterval(timerGemme);
        window.clearInterval(timerAumentoDifficolta);
        window.clearInterval(timerDurataPartita);
        window.clearTimeout(timerPotere);
        if (potereAttivo) {
            if (colpibile == false) {
                colpibile = true;
            } else {
                danno = danno / 2;
            }
        }
        cambioSezione();
        listaPalle.length = 0;
        listaProiettili.length = 0;
        padre.querySelector("nav").style.display = "";

        punteggioAttuale = countdown;
        document.getElementById("barraCentro").innerText = "";

        if (modalita == "endless" && punteggioAttuale > recordEndless) {
            recordEndless = punteggioAttuale;
        } else {
            if (modalita == "livello1" && punteggioAttuale > recordLivello1) {
                recordLivello1 = punteggioAttuale;
            } else {
                if (modalita == "livello2" && punteggioAttuale > recordLivello2) {
                    recordLivello2 = punteggioAttuale;
                } else {
                    if (modalita == "livello3" && punteggioAttuale > recordLivello3) {
                        recordLivello3 = punteggioAttuale;
                    } else {
                        if (modalita == "livello4" && punteggioAttuale > recordLivello4) {
                            recordLivello4 = punteggioAttuale;
                        }
                    }
                }
            }
        }
    }
    function vittoria() {
        finePartita();
        schermataVittoria();
        if (modalita == "livello1") {
            gemmeDurantePartita = 5;
        } else {
            if (modalita == "livello2") {
                gemmeDurantePartita = 15;
            } else {
                if (modalita == "livello3") {
                    gemmeDurantePartita = 25;
                } else {
                    if (modalita == "livello4") {
                        gemmeDurantePartita = 50;
                    }
                }
            }
        }
        massimoPalle = 3;
        vitaPalle = 200;
        monete += moneteDurantePartita;//forse sposta ad un timer cosi da aggiornare in tempo reale
        gemme += gemmeDurantePartita;//forse sposta ad un timer cosi da aggiornare in tempo reale
        moneteDurantePartita = 0;
        gemmeDurantePartita = 0;
        kill = 0;
        document.getElementById("coin").innerText = monete;
        document.getElementById("diamante").innerText = gemme;
    }
    function schermataVittoria() {
        creaSchermata();
        schermataGioco.innerHTML = "<h2> Hai vinto!</h2> <span><p>monete ottenute: " + moneteDurantePartita + "</p><p>gemme ottenute: " + gemmeDurantePartita + "</p></span> <button>riprova</button>";
        schermataGioco.querySelector("button").addEventListener("click", livelloSelezionato); //mhh me puzza
    }
    function sconfitta() {
        finePartita()
        schermataSconfitta();
        massimoPalle = 3;
        vitaPalle = 200;
        monete += moneteDurantePartita;//forse sposta ad un timer cosi da aggiornare in tempo reale
        gemme += gemmeDurantePartita;//forse sposta ad un timer cosi da aggiornare in tempo reale
        moneteDurantePartita = 0;
        gemmeDurantePartita = 0;
        document.getElementById("coin").innerText = monete;
        document.getElementById("diamante").innerText = gemme;
    }
    function schermataSconfitta() {
        creaSchermata();
        if (modalita == "endless") {
            schermataGioco.innerHTML = "<h2> Hai perso!</h2> <span><p>monete ottenute: " + moneteDurantePartita + "</p><p>gemme ottenute: " + gemmeDurantePartita + "</p><p>punteggio:" + punteggioAttuale + "</p><p>record:" + recordEndless + "</p></span> <button>riprova</button>";
            schermataGioco.querySelector("button").addEventListener("click", livelloSelezionato); //mhh me puzza
        } else {
            schermataGioco.innerHTML = "<h2> Hai perso!</h2> <span><p>monete ottenute: " + moneteDurantePartita + "</p><p>gemme ottenute: " + gemmeDurantePartita + "</p></span> <button>riprova</button>";
            schermataGioco.querySelector("button").addEventListener("click", livelloSelezionato); //mhh me puzza
        }
    }
    function collisioniProiettilePalla() {
        for (let j = 0; j < listaPalle.length; j++) {
            for (let i = 0; i < listaProiettili.length; i++) {
                console.log(((listaProiettili[i].x >= listaPalle[j].x && listaProiettili[i].x <= listaPalle[j].x + dimensioniPalleWidth)
                    ||
                    (listaProiettili[i].x + dimensioniProiettiliWidth >= listaPalle[j].x && listaProiettili[i].x + dimensioniProiettiliWidth <= listaPalle[j].x + dimensioniPalleWidth))
                    &&
                    ((listaProiettili[i].y >= listaPalle[j].y && listaProiettili[i].y <= listaPalle[j].y + dimensioniPalleHeight)
                        ||
                        (listaProiettili[i].y + dimensioniProiettiliHeight >= listaPalle[j].y && listaProiettili[i].y + dimensioniProiettiliHeight <= listaPalle[j].y + dimensioniPalleHeight)));



                if (((listaProiettili[i].x >= listaPalle[j].x && listaProiettili[i].x <= listaPalle[j].x + dimensioniPalleWidth)
                    ||
                    (listaProiettili[i].x + dimensioniProiettiliWidth >= listaPalle[j].x && listaProiettili[i].x + dimensioniProiettiliWidth <= listaPalle[j].x + dimensioniPalleWidth))
                    &&
                    ((listaProiettili[i].y >= listaPalle[j].y && listaProiettili[i].y <= listaPalle[j].y + dimensioniPalleHeight)
                        ||
                        (listaProiettili[i].y + dimensioniProiettiliHeight >= listaPalle[j].y && listaProiettili[i].y + dimensioniProiettiliHeight <= listaPalle[j].y + dimensioniPalleHeight))) {
                    //hittato
                    // window.clearInterval(timerMuoviProiettili);
                    // window.clearInterval(timerMuoviPalle);
                    padre.removeChild(listaProiettili[i].corpo);
                    listaProiettili.splice(i, 1);
                    listaPalle[j].vita -= danno;
                    listaPalle[j].scritta.innerText = listaPalle[j].vita;
                    if (listaPalle[j].vita <= 0) {
                        if (!potereAttivo) {
                            if (potereDannoDoppioSbloccato || potereInvisibileSbloccato) {
                                let spawnaPotere = Math.floor(Math.random() * 5);
                                console.log("inizio test:");
                                console.log(spawnaPotere);
                                if (spawnaPotere == 1 && !potere) {
                                    potere = {
                                        corpo: document.createElement("img"),
                                        x: listaPalle[j].x,
                                        y: listaPalle[j].y,
                                    }
                                    let scegliPotereDaSpawnare = Math.floor(Math.random() * 2);
                                    if (scegliPotereDaSpawnare == 0) {
                                        if (potereDannoDoppioSbloccato) {
                                            //dannoDoppio
                                            potere.id = "dannoDoppio";
                                            potere.immagine = "Immagini/icone/x2.png";
                                        } else {
                                            //invisibile
                                            potere.id = "invisibile";
                                            potere.immagine = "Immagini/icone/fantasmino.png";
                                        }
                                    } else {
                                        if (potereInvisibileSbloccato) {
                                            //dannoDoppio
                                            potere.id = "invisibile";
                                            potere.immagine = "Immagini/icone/fantasmino.png";
                                        } else {
                                            //invisibile
                                            potere.id = "dannoDoppio";
                                            potere.immagine = "Immagini/icone/x2.png";

                                        }
                                    }
                                    console.log("la palla spawna");
                                    potere.corpo.src = potere.immagine;
                                    potere.corpo.className = "potere";
                                    potere.corpo.style.left = potere.x + "px";
                                    potere.corpo.style.top = potere.y + "px";
                                    padre.appendChild(potere.corpo);
                                    controllaCollisioniPotere = true;
                                }
                            }
                        }
                        padre.removeChild(listaPalle[j].corpo);
                        padre.removeChild(listaPalle[j].scritta);
                        listaPalle.splice(j, 1);
                        moneteDurantePartita += 5;
                        kill++;
                        if (kill == obbiettivoKill && modalita != "endless") { fuoriPartita = true; vittoria() };
                    }
                }
            }
        }
    }
</script>
<style>
    body {
        background-repeat: no-repeat;
        background-size: 100% 100%;
        background-color: green;
        margin: 0;
        height: 100vh;
        overflow: hidden;
    }

    nav {
        position: fixed;
        bottom: 0;
        height: 20vh;
        width: 100vw;
        display: flex;
        /* transition: display 1.3s ease; */
    }

    /* nav img {
        width: 100%;
    } */
    nav div {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        /* background-image: url("Immagini/bottoni/button.png"); */
        background-repeat: no-repeat;
        background-size: 100% 100%;
        /* padding-left: 100%;
        padding-right: 100%; */
    }

    nav div img {
        height: 150px;
    }

    /* #infinito {
        height: 250px;
         padding-inline: 100%; 
    } */
    nav div:first-of-type img {
        height: 250px;
    }

    #schermataGioco {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-repeat: no-repeat;
        background-size: 100% 100%;
        text-align: center;
        position: fixed;
        z-index: 3;
        margin-top: 10vh;
        margin-left: 25vw;
        height: 50vh;
        width: 50vw;
    }

    #schermataGioco button {
        width: 100px;
        padding: 20px;
        margin-top: 20px;
        border-radius: 1rem;
    }

    body>img {
        position: fixed;
    }

    .vita {
        position: fixed;
        color: blue;
        font-size: 5em;
        text-align: center;
        margin: 0;
        text-shadow: 2px 2px 0 white;
    }

    #centraLivelli {
        display: flex;
        justify-content: space-evenly;
        padding-top: 25vh;
    }

    .livello {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10em;
        background-image: url("Immagini/bottoni/pilastro.png");
        background-repeat: no-repeat;
        background-size: 100% 100%;
        text-align: center;
        width: 200PX;
        height: 200PX;
    }

    /* #barra {
        display: flex;
        justify-content: space-between;
    } */


    /* #barraSinistra {
        position: absolute;
        left: 0%;
    }

    #barraCentro {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .barraDestra {
        position: absolute;
        left: 100%;
    } */
    #barraSinistra {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 250%;
        /* background-image: url("Immagini/icone/sound.png"); */
        background-repeat: no-repeat;
        background-size: 100% 100%;
        height: 100px;
        width: 100px;
        font-size: 250%;
    }

    #coin {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 250%;
        background-image: url("Immagini/icone/coin.png");
        background-repeat: no-repeat;
        background-size: 100% 100%;
        height: 100px;
        width: 100px;
    }

    #diamante {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 250%;
        background-image: url("Immagini/icone/diamante.png");
        background-repeat: no-repeat;
        background-size: 100% 100%;
        height: 100px;
        width: 100px;
    }

    #barra {
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        /* Usa flexbox */
        justify-content: space-between;
        /* Spaziatura tra gli elementi */
        align-items: center;
        /* Allinea gli oggetti verticalmente al centro */
        width: 100%;
        height: 120px;
        /* Assicurati che il contenitore occupi tutta la larghezza */
        position: relative;
        z-index: 6;
        /*forse basta 5; */
    }

    #barraCentro {
        text-align: center;
        font-size: 5em;
        /* Centra il testo nel div */
        flex-grow: 1;
        /* Fai in modo che il centro prenda il massimo spazio possibile */
        /* text-align: center;   
               Centra il testo nel div */

    }

    #sezioneArticoli {
        display: flex;
        width: 100vw;
        height: 80vh;
        /* min-height: 0; */
        /* border-collapse: collapse; */
    }

    #sezioneArticoli>div {
        width: 100%;
        /* height: 80vh; */
    }

    /* #sezioneArticoli>div.barraPresente {
        width: 100%;
        height: 70vh;
    } */

    /* #sezioneArticoli img {
        /* width: 100%;
        height: 25%;
        flex: 1
    } */

    #sezionePotenziamenti {
        display: flex;
        flex-direction: column;
    }

    #sezionePoteri {
        display: flex;
        flex-direction: column;
    }

    #sezioneTemi {
        display: flex;
        flex-direction: column;
    }

    #sezioneArticoli.barraPresente {
        height: calc(80vh - 120px);
    }

    .prezzo {
        display: flex;
        align-items: center;
        justify-content: center;
        background-repeat: no-repeat;
        flex-direction: column;
        background-size: 100% 100%;
        flex: 1;
        font-size: 5em;
        text-align: center;
        /* display: flex;
        flex: 1; */
        height: 100%;
        width: 100%;
    }

    #centraTemi {
        display: flex;
        width: 100vw;
        height: 80vh;
        padding-top: 20vh;
    }

    #centraTemi.barraPresente {
        height: calc(80vh - 120px);
    }

    .guardaroba {
        width: 20%;
        height: 50%;
    }

    input.sliderAudio {
        position: fixed;
        width: 200px;
        left: calc(50vw - 100px);
        top: 50vh;
    }

    label.sliderAudio {
        position: fixed;
        width: 200px;
        left: calc(50vw - 100px);
        top: 48vh;
        text-align: center;
    }

    input.sliderPasso {
        position: fixed;
        width: 200px;
        left: calc(50vw - 100px);
        top: 54vh;
    }

    label.sliderPasso {
        position: fixed;
        width: 200px;
        left: calc(50vw - 100px);
        top: 52vh;
        text-align: center;
    }

    .potere {
        position: fixed;
        height: 200px;
        width: 200px;
    }

    .prezzo img {
        height: 100px;
    }

    .prezzo label img {
        position: relative;
        top: 20px;
    }
</style>

<body onload="onload()">
    <audio src="Green Day - American Idiot.mp3" id="musicaBackground" loop></audio>
    <div class="barra" id="barra">
        <div class="barra" id="barraSinistra">CTRL</div>
        <!-- <img class="barra" id="barraSinistra" src="Immagini/icone/sound.png"> -->
        <div class="barra" id="barraCentro"></div>
        <div class="barra" id="coin">0</div>
        <div class="barra" id="diamante">0</div>
        <!-- <img class="barra" src="Immagini/icone/coin.png">
        <img class="barra" src="Immagini/icone/diamante.png"> -->
    </div>
    <nav class="menu">
        <div class="menu endless" onclick="livelloSelezionato(event)"><img src="Immagini/icone/infinito.png"
                class="menu endless"></div>
        <div class="menu" onclick="sezioneLivelli()"><img src="Immagini/icone/livelli.png" class="menu"></div>
        <div class="menu" onclick="sezioneNegozio()"><img src="Immagini/icone/negozio.png" class="menu"></div>
        <div class="menu" onclick="sezioneGuardaroba()"><img src="Immagini/icone/gruccia.png" class="menu"></div>
        <div class="menu" onclick="sezioneImpostazioni()"><img src="Immagini/icone/ingranaggio.png" class="menu"></div>

        <!-- <img class="menu" id="endless" src="button.png" onclick="livelloSelezionato(event)">
        <img class="menu" src="button Candyland.png" onclick="sezioneLivelli()">
        <img class="menu" src="button Galaxy.png" onclick="sezioneNegozio()">
        <img class="menu" src="button Inferno.png" onclick="sezioneGuardaroba()">
        <img class="menu" src="coez.png" onclick="sezioneImpostazioni()"> -->
    </nav>
</body>

</html>